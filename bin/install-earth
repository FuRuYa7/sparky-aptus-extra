#!/bin/bash

# Sparky Install Earth script can download and install Google Earth application
# from Google server. It supports the current version 7 and older version 6 for older machines.
#
# Created by Pawe≈Ç "pavroo" Pijanowski 2015/06/01
# Last updated 2017/11/11
# Copyright 2015, 2016, 2017 under the GNU GPL2 License

# get default's locale file
DEFLOCDIR="/usr/share/sparky/sparky-aptus-extra"
if [ "`cat /etc/default/locale | grep el_GR`" != "" ]; then
. $DEFLOCDIR/el
elif [ "`cat /etc/default/locale | grep es_AR`" != "" ]; then
. $DEFLOCDIR/es
elif [ "`cat /etc/default/locale | grep fr_FR`" != "" ]; then
. $DEFLOCDIR/fr
elif [ "`cat /etc/default/locale | grep it_IT`" != "" ]; then
. $DEFLOCDIR/it
elif [ "`cat /etc/default/locale | grep ja_JP`" != "" ]; then
. $DEFLOCDIR/ja
elif [ "`cat /etc/default/locale | grep pl_PL`" != "" ]; then
. $DEFLOCDIR/pl
elif [ "`cat /etc/default/locale | grep pt_BR`" != "" ]; then
. $DEFLOCDIR/pt_BR
elif [ "`cat /etc/default/locale | grep pt_PT`" != "" ]; then
. $DEFLOCDIR/pt_PT
elif [ "`cat /etc/default/locale | grep ru_RU`" != "" ]; then
. $DEFLOCDIR/ru
elif [ "`cat /etc/default/locale | grep sv_SE`" != "" ]; then
. $DEFLOCDIR/se
else
. $DEFLOCDIR/en
fi

testroot="`whoami`"

if [ "$testroot" != "root" ]; then
	echo "Must be root, exiting now..."
fi

DIALOG="yad --window-icon=google-earth --width=450 --height=200 --center"
DIALOG2="yad --window-icon=google-earth --width=550 --height=300 --center"
TITLE="--always-print-result --dialog-sep --image=google-earth --title="
TEXT="--text="
OKEXIT=" --button=Ok:0 --button=$LOCAL63:1 "
MSGBOX=" --button=Ok:0 "
MENU="--list --column=$LOCAL1 --column=$LOCAL2"
TITLETEXT="$LOCAL64"
WORKDIR="/tmp/sparky-earth"
ARCH=`uname -r | grep "amd64" | awk '{print $1}'`

if [ -f /opt/sparky/sparky-xterm ]; then
. /opt/sparky/sparky-xterm
else
SPARKYXTERM="x-terminal-emulator"
fi

TEXTBROKEN="$LOCAL4"
TEXTDONE="$LOCAL59"
TEXTSTOP="$LOCAL7"
SERVERD="https://www.dropbox.com/s/nmue9o6tfug23ho"
PACK632="googleearth_6.0.3.2197%2B1.2.0-1_i386.deb"
SERVERG="https://dl.google.com/dl/earth/client/current"
PACK732="google-earth-pro-stable_current_i386.deb"
PACK764="google-earth-pro-stable_current_amd64.deb"
FOREIGN=`dpkg --print-foreign-architectures | grep "i386" | awk '{print $1}'`
ARCHARM="`uname -m | grep arm`"
if [ "$ARCHARM" != "" ]; then
	$DIALOG $TEXT"\n$LOCAL89\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
	exit 1
fi

mainmenu () {
CHOICES=`$DIALOG2 $TITLE"$TITLETEXT" $OKEXIT $MENU $TEXT"$LOCAL65" \
Install_v6 "$LOCAL66 (32 bit)" \
Install_v7 "$LOCAL67" \
Exit "$LOCAL68"`

if [ "$?" = "0" ]; then
	CHOICE=`echo $CHOICES | cut -d "|" -f 1`
else
	exit 0
fi

if [ "$CHOICE" = "Install_v6" ]; then
	install6menu
elif [ "$CHOICE" = "Install_v7" ]; then
	install7menu
elif [ "$CHOICE" = "Exit" ]; then
	exit 0
else
	exit 0
fi
}

install6menu () {
if [ "$ARCH" = "" ]; then
	install632menu
else
#	install664menu
	$DIALOG $TITLE"$TITLETEXT" $MSGBOX $TEXT"$LOCAL80"
	mainmenu
fi
}

install632menu () {
# check is google-earth 6 installed
if [ -f /usr/bin/googleearth ]; then
	$DIALOG $TITLE"$TITLETEXT" $MSGBOX $TEXT"$TEXTSTOP"
	exit 0

	# download deb package from the project server
else
	rm -rf $WORKDIR
	mkdir -p $WORKDIR
	cd $WORKDIR
	$SPARKYXTERM -e "wget $SERVERD/$PACK632 -O google32.deb"
fi

# install deb package
if [ -f $WORKDIR/*.deb ]; then
	cd $WORKDIR
	$SPARKYXTERM -e "dpkg -i google32.deb"
	$SPARKYXTERM -e "apt-get install -f -y"

else
	$DIALOG $TITLE"$TITLETEXT" $MSGBOX $TEXT"$TEXTBROKEN"
	mainmenu
fi

# check has the package been installed
if [ -f /usr/bin/googleearth ]; then
	$DIALOG $TITLE"$TITLETEXT" $MSGBOX $TEXT"$TEXTDONE"
	exit 0

else
	$DIALOG $TITLE"$TITLETEXT" $MSGBOX $TEXT"$TEXTBROKEN"
	mainmenu
fi

}

#install664menu () {
# check is google-earth 6 installed
#if [ -f /usr/bin/googleearth ]; then
#	$DIALOG $TITLE"$TITLETEXT" $MSGBOX $TEXT"$TEXTSTOP"
#	mainmenu

	# download deb package from the project server
#else
#	rm -rf $WORKDIR
#	mkdir -p $WORKDIR
#	cd $WORKDIR
#	$SPARKYXTERM -e "wget $SERVERD/$PACK632 -O google32.deb"
#fi

# check does your 64 bit system have multi-arch support enabled for i386 architecture
#if [ "$FOREIGN" = "" ]; then
#	dpkg --add-architecture i386
#	$SPARKYXTERM -e "apt-get update"
#fi

# install deb package
#if [ -f $WORKDIR/*.deb ]; then
#	cd $WORKDIR
#	$SPARKYXTERM -e "dpkg -i google32.deb"
#	$SPARKYXTERM -e "apt-get install -f -y"

#else
#	$DIALOG $TITLE"$TITLETEXT" $MSGBOX $TEXT"$TEXTBROKEN"
#	mainmenu
#fi

# check has the deb been installed
#if [ -f /usr/bin/googleearth ]; then
#	$DIALOG $TITLE"$TITLETEXT" $MSGBOX $TEXT"$TEXTDONE"
#	exit 0

#else
#	$DIALOG $TITLE"$TITLETEXT" $MSGBOX $TEXT"$TEXTBROKEN"
#	mainmenu
#fi

#}

install7menu () {
# check is google-earth 7 installed
if [ -f /usr/bin/google-earth-pro ]; then
	$DIALOG $TITLE"$TITLETEXT" $MSGBOX $TEXT"$TEXTSTOP"
	xit 0

	# download deb package from the project server
else

	rm -rf $WORKDIR
	mkdir -p $WORKDIR
	cd $WORKDIR

	if [ "$ARCH" = "" ]; then
		$SPARKYXTERM -e "wget $SERVERG/$PACK732"
	else
		$SPARKYXTERM -e "wget $SERVERG/$PACK764"
	fi

fi

# install deb package
if [ -f $WORKDIR/*.deb ]; then
	cd $WORKDIR

	if [ "$ARCH" = "" ]; then
		$SPARKYXTERM -e "dpkg -i $PACK732"

	else
		$SPARKYXTERM -e "dpkg -i $PACK764"

	fi

	$SPARKYXTERM -e "apt-get install -f -y"

else
	$DIALOG $TITLE"$TITLETEXT" $MSGBOX $TEXT"$TEXTBROKEN"
	mainmenu
fi

# check has the package been installed
if [ -f /usr/bin/google-earth-pro ]; then
	$DIALOG $TITLE"$TITLETEXT" $MSGBOX $TEXT"$TEXTDONE"
	exit 0

else
	$DIALOG $TITLE"$TITLETEXT" $MSGBOX $TEXT"$TEXTBROKEN"
	mainmenu
fi

}

mainmenu
