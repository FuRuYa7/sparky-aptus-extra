#!/bin/bash

# Sparky APTus Extra is a simply GUI frontend for APT-GET
# It lets you install aditional software from Debiam, Sparky and 3th party repositories
# Created by Pawe≈Ç "pavroo" Pijanowski 2014/08/15
# Copyright 2014-2018 under the GNU GPL2 License
# Last updated 2018/05/04

# get default's locale file
DEFLOCDIR="/usr/share/sparky/sparky-aptus-extra"
if [ "`cat /etc/default/locale | grep el_GR`" != "" ]; then
. $DEFLOCDIR/el
elif [ "`cat /etc/default/locale | grep es_AR`" != "" ]; then
. $DEFLOCDIR/es
elif [ "`cat /etc/default/locale | grep fr_FR`" != "" ]; then
. $DEFLOCDIR/fr
elif [ "`cat /etc/default/locale | grep it_IT`" != "" ]; then
. $DEFLOCDIR/it
elif [ "`cat /etc/default/locale | grep ja_JP`" != "" ]; then
. $DEFLOCDIR/ja
elif [ "`cat /etc/default/locale | grep pl_PL`" != "" ]; then
. $DEFLOCDIR/pl
elif [ "`cat /etc/default/locale | grep pt_BR`" != "" ]; then
. $DEFLOCDIR/pt_BR
elif [ "`cat /etc/default/locale | grep pt_PT`" != "" ]; then
. $DEFLOCDIR/pt_PT
elif [ "`cat /etc/default/locale | grep ru_RU`" != "" ]; then
. $DEFLOCDIR/ru
elif [ "`cat /etc/default/locale | grep sv_SE`" != "" ]; then
. $DEFLOCDIR/se
else
. $DEFLOCDIR/en
fi

testroot="`whoami`"
if [ "$testroot" != "root" ]; then
	echo "Must be root... Exiting..."
fi

DIALOG="yad --window-icon=system-software-install --width=450 --height=200 --center"
TITLE="--always-print-result --dialog-sep --image=system-software-install --title="
TEXT="--text="
OKEXIT=" --button=Ok:0 --button=$LOCAL63:1 "
MSGBOX=" --button=Ok:0 "
BUTTONREMOVE="--button=$LOCAL102:3"
BUTTONREINSTALL="--button=$LOCAL103:4"
BUTTONINSTALL="--button=$LOCAL104:0"
BUTTONEXIT="--button=$LOCAL63:1"
TITLETEXT="APTus"
if [ -f /usr/bin/sparky-xterm ];then
	SPARKYXTERM="/usr/bin/sparky-xterm"
else
	echo "sparky-xterm is missing... Exiting..."
	exit 1
fi
INSTALL="apt-get install"
REINSTALL="apt-get install --reinstall"
UNINSTALL="apt-get purge"
ARCH64="`uname -m | grep x86_64`"
ARCH32="`uname -m | grep 686`"
ARCHARM="`uname -m | grep arm`"
SPARKYVERCHECK5="`cat /etc/issue | grep 5`"
DEBIANVERCHECK10="`cat /etc/issue | grep buster`"
PINGTEST=$(ping -c 1 debian.org | grep [0-9])

# recive package name
case $1 in
#####audio###################################################
  alsaplayer-gtk)
	PACKAGE="alsaplayer-gtk"
     ;;
  amarok)
	PACKAGE="amarok+"
     ;;
  audacious)
	PACKAGE="audacious"
     ;;
  cantata)
	PACKAGE="cantata"
     ;;
  clementine)
	PACKAGE="clementine"
     ;;
  cmus)
	PACKAGE="cmus"
     ;;
  deadbeef)
	if [ "$ARCHARM" != "" ]; then
		$DIALOG $TEXT"\n$LOCAL110\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
		exit 1
	fi
	PACKAGE="deadbeef"
     ;;
  dradio)
	PACKAGE="dradio"
     ;;
  exaile)
	PACKAGE="exaile"
     ;;
  gmerlin)
	PACKAGE="gmerlin"
     ;;
  gmusicbrowser)
	PACKAGE="gmusicbrowser"
     ;;
  gnome-music)
	PACKAGE="gnome-music"
     ;;
  gradio)
	PACKAGE="gradio"
     ;;
  juk)
	PACKAGE="juk"
     ;;
  kscd)
	PACKAGE="kscd"
     ;;
  lxmusic)
	PACKAGE="lxmusic"
     ;;
  moc)
	PACKAGE="moc"
     ;;
  musique)
	PACKAGE="musique"
     ;;
  pmrp)
	PACKAGE="pmrp"
     ;;
  pragha)
	if [ "$SPARKYVERCHECK5" != "" ] || [ "$DEBIANVERCHECK10" != "" ]; then
		$DIALOG $TEXT"\n$LOCAL110\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
		exit 1
	fi
	PACKAGE="pragha"
     ;;
  qmmp)
	PACKAGE="qmmp"
     ;;
  quodlibet)
	PACKAGE="quodlibet"
     ;;
  radiotray)
	PACKAGE="radiotray"
     ;;
  rhythmbox)
	PACKAGE="rhythmbox"
     ;;
  sayonara)
	if [ "$ARCHARM" != "" ]; then
		$DIALOG $TEXT"\n$LOCAL110\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
		exit 1
	fi
	PACKAGE="sayonara"
     ;;
  spotify-client)
	if [ "$ARCHARM" != "" ]; then
		$DIALOG $TEXT"\n$LOCAL110\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
		exit 1
	fi
	PACKAGE="spotify-client"
     ;;
  xmms2)
	PACKAGE="xmms2"
     ;;
  yarock)
	if [ "$ARCHARM" != "" ]; then
		$DIALOG $TEXT"\n$LOCAL110\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
		exit 1
	fi
	PACKAGE="yarock"
     ;;
######email clients##########################################
  alpine)
	PACKAGE="alpine"
     ;;
  claws-mail)
	PACKAGE="claws-mail"
     ;;
  evolution)
	PACKAGE="evolution"
     ;;
  geary)
	PACKAGE="geary"
     ;;
  kmail)
	PACKAGE="kmail"
     ;;
  mutt)
	PACKAGE="mutt"
     ;;
  sylpheed)
	PACKAGE="sylpheed"
     ;;
  thunderbird)
	PACKAGE="thunderbird"
     ;;
  trojita)
	PACKAGE="trojita"
     ;;
######file transfer##########################################
  amule)
	PACKAGE="amule"
     ;;
  aria2)
	PACKAGE="aria2"
     ;;
  bitstormlite)
	PACKAGE="bitstormlite"
     ;;
  bittornado-gui)
	PACKAGE="bittornado-gui"
     ;;
  bittorrent-gui)
	PACKAGE="bittorrent-gui"
     ;;
  ctorrent)
	PACKAGE="ctorrent"
     ;;
  deluge)
	PACKAGE="deluge"
     ;;
  dropbox)
	if [ "$ARCHARM" != "" ]; then
		$DIALOG $TEXT"\n$LOCAL110\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
		exit 1
	fi
	PACKAGE="dropbox"
     ;;
  filezilla)
	PACKAGE="filezilla"
     ;;
  gftp)
	PACKAGE="gftp-gtk"
     ;;
  gtk-gnutella)
	PACKAGE="gtk-gnutella"
     ;;
  jftp)
	PACKAGE="jftp"
     ;;
  kget)
	PACKAGE="kget"
     ;;
  ktorrent)
	PACKAGE="ktorrent"
     ;;
  lftp)
	PACKAGE="lftp"
     ;;
  megasync)
	if [ "$ARCHARM" != "" ]; then
		$DIALOG $TEXT"\n$LOCAL110\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
		exit 1
	fi
	PACKAGE="megasync"
     ;;
  mldonkey-gui)
	PACKAGE="mldonkey-gui"
     ;;
  ncftp)
	PACKAGE="ncftp"
     ;;
  nicotine)
	PACKAGE="nicotine"
     ;;
  qbittorrent)
	PACKAGE="qbittorrent"
     ;;
  rtorrent)
	PACKAGE="rtorrent"
     ;;
  spideroakone)
	if [ "$ARCHARM" != "" ]; then
		$DIALOG $TEXT"\n$LOCAL110\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
		exit 1
	fi
	PACKAGE="spideroakone"
     ;;
  transmission)
	PACKAGE="transmission"
     ;;
  uftp)
	PACKAGE="uftp"
     ;;
  uget)
	PACKAGE="uget"
     ;;
  vuze)
	PACKAGE="vuze"
     ;;
  wget)
	PACKAGE="wget"
     ;;
  youtube-dlg)
	PACKAGE="youtube-dlg"
     ;;
######graphics###############################################
  blender)
	PACKAGE="blender"
     ;;
  camorama)
	PACKAGE="camorama"
     ;;
  darktable)
	if [ "$ARCH32" != "" ]; then
		$DIALOG $TEXT"\n$LOCAL110\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
		exit 1
	fi
	PACKAGE="darktable"
     ;;
  digikam)
	PACKAGE="digikam"
     ;;
  eog)
	PACKAGE="eog"
     ;;
  eom)
	PACKAGE="eom"
     ;;
  ephoto)
	PACKAGE="ephoto"
     ;;
  feh)
	PACKAGE="feh"
     ;;
  flameshot)
	PACKAGE="flameshot"
     ;;
  fotoxx)
	PACKAGE="fotoxx"
     ;;
  geeqie)
	PACKAGE="geeqie"
     ;;
  gimp)
	PACKAGE="gimp"
     ;;
  gnome-paint)
	PACKAGE="gnome-paint"
     ;;
  gnome-screenshot)
	PACKAGE="gnome-screenshot"
     ;;
  gpicview)
	PACKAGE="gpicview"
     ;;
  gscreenshot)
	PACKAGE="gscreenshot"
     ;;
  gthumb)
	PACKAGE="gthumb"
     ;;
  gtkam)
	PACKAGE="gtkam"
     ;;
  gwenview)
	PACKAGE="gwenview"
     ;;
  hugin)
	PACKAGE="hugin"
     ;;
  imagemagick)
	PACKAGE="imagemagick"
     ;;
  inkscape)
	PACKAGE="inkscape"
     ;;
  k3d)
	PACKAGE="k3d"
     ;;
  kamera)
	PACKAGE="kamera"
     ;;
  karbon)
	PACKAGE="karbon"
     ;;
  kde-spectale)
	PACKAGE="kde-spectale"
     ;;
  kolourpaint)
	if [ "$SPARKYVERCHECK5" != "" ] || [ "$DEBIANVERCHECK10" != "" ]; then
		$DIALOG $TEXT"\n$LOCAL110\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
		exit 1
	fi
	PACKAGE="kolourpaint"
     ;;
  krita)
	PACKAGE="krita"
     ;;
  lightzone)
	if [ "$ARCHARM" != "" ]; then
		$DIALOG $TEXT"\n$LOCAL110\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
		exit 1
	fi
	PACKAGE="lightzone"
     ;;
  lximage-qt)
	PACKAGE="lximage-qt"
     ;;
  opentoonz)
	if [ "$ARCHARM" != "" ]; then
		$DIALOG $TEXT"\n$LOCAL110\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
		exit 1
	fi
	PACKAGE="opentoonz"
     ;;
  rawtherapee)
	PACKAGE="rawtherapee"
     ;;
  ristretto)
	PACKAGE="ristretto"
     ;;
  shotwell)
	PACKAGE="shotwell"
     ;;
  synfigstudio)
	PACKAGE="synfigstudio"
     ;;
  tuxpaint)
	PACKAGE="tuxpaint"
     ;;
  viewnior)
	PACKAGE="viewnior"
     ;;
  xnview)
	if [ "$ARCHARM" != "" ]; then
		$DIALOG $TEXT"\n$LOCAL110\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
		exit 1
	fi
	PACKAGE="xnview"
     ;;
  xpaint)
	PACKAGE="xpaint"
     ;;
#####im######################################################
  bti)
	PACKAGE="bti"
     ;;
  corebird)
	PACKAGE="corebird"
     ;;
  ekg2)
	PACKAGE="ekg2-ui-gtk"
     ;;
  empathy)
	PACKAGE="empathy"
     ;;
  gajim)
	PACKAGE="gajim"
     ;;
  hexchat)
	PACKAGE="hexchat"
     ;;
  ircii)
	PACKAGE="ircii"
     ;;
  irssi)
	PACKAGE="irssi"
     ;;
  kadu)
	PACKAGE="kadu"
     ;;
  konversation)
	PACKAGE="konversation"
     ;;
  kopete)
	PACKAGE="kopete"
     ;;
  kvirc)
	PACKAGE="kvirc"
     ;;
  loqui)
	PACKAGE="loqui"
     ;;
  lostirc)
	PACKAGE="lostirc"
     ;;
  pidgin)
	PACKAGE="pidgin"
     ;;
  pork)
	PACKAGE="pork"
     ;;
  psi)
	PACKAGE="psi"
     ;;
  quassel)
	PACKAGE="quassel"
     ;;
  scrollz)
	PACKAGE="scrollz"
     ;;
  sic)
	PACKAGE="sic"
     ;;
  smuxi)
	PACKAGE="smuxi"
     ;;
  skypeforlinux)
	if [ "$ARCH64" = "" ]; then
		$DIALOG $TEXT"\n$LOCAL110\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
		exit 1
	fi
	PACKAGE="skypeforlinux"
	WORKDIRSKYPE="/tmp/skype-tmp"
	SERVER64SKYPE="https://go.skype.com"
	PACK64SKYPE="skypeforlinux-64.deb"
     ;;
  telegram-desktop)
	if [ "$SPARKYVERCHECK5" != "" ] || [ "$DEBIANVERCHECK10" != "" ]; then
		$DIALOG $TEXT"\n$LOCAL110\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
		exit 1
	fi
	PACKAGE="telegram-desktop"
     ;;
  tinyirc)
	PACKAGE="tinyirc"
     ;;
  tkabber)
	PACKAGE="tkabber"
     ;;
  tor-messenger)
  	if [ "$ARCHARM" != "" ]; then
		$DIALOG $TEXT"\n$LOCAL110\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
		exit 1
	fi
	PACKAGE="tor-messenger"
     ;;
  twinkle)
	PACKAGE="twinkle"
     ;;
  weechat)
	PACKAGE="weechat"
     ;;
######rss readers##############################################
  akregator)
	PACKAGE="akregator"
     ;;
  liferea)
	PACKAGE="liferea"
     ;;
  nrss)
	PACKAGE="nrss"
     ;;
  quiterss)
	PACKAGE="quiterss"
     ;;
  rawdog)
	PACKAGE="rawdog"
     ;;
  rssguard)
	PACKAGE="rssguard"
     ;;
  rsstail)
	PACKAGE="rsstail"
     ;;
  tickr)
	PACKAGE="tickr"
     ;;
#####video####################################################
  gnome-mpv)
	PACKAGE="gnome-mpv"
     ;;
  kmplayer)
	PACKAGE="kmplayer"
     ;;
  kodi)
	PACKAGE="kodi"
     ;;
  motionbox)
	if [ "$ARCHARM" != "" ]; then
		$DIALOG $TEXT"\n$LOCAL110\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
		exit 1
	fi
	PACKAGE="motionbox"
     ;;
  mplayer)
	PACKAGE="mplayer"
     ;;
  mpv)
	PACKAGE="mpv"
     ;;
  parole)
	PACKAGE="parole"
     ;;
  rage)
	if [ "$ARCHARM" != "" ]; then
		$DIALOG $TEXT"\n$LOCAL110\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
		exit 1
	fi
	PACKAGE="rage"
     ;;
  smplayer)
	PACKAGE="smplayer"
     ;;
  smtube)
	PACKAGE="smtube"
     ;;
  totem)
	PACKAGE="totem"
     ;;
  vlc)
	PACKAGE="vlc"
     ;;
  vokoscreen)
	PACKAGE="vokoscreen"
     ;;
  xine-ui)
	PACKAGE="xine-ui"
     ;;
esac
###############################################################
if [ "$1" = "lightzone" ]; then
	CHECKPACKAGE="/usr/bin/$PACKAGE"
elif [ "$1" = "xnview" ]; then
	CHECKPACKAGE="/usr/bin/$PACKAGE"
else
	CHECKPACKAGE="/usr/share/doc/$PACKAGE"
fi

# install, reinstall or remove skype
if [ "$1" = "skypeforlinux" ]; then

	if [ -d "$CHECKPACKAGE" ]; then
		$DIALOG $TEXT"\n$LOCAL105\n$LOCAL106" $TITLE"$TITLETEXT" $BUTTONREMOVE $BUTTONREINSTALL $BUTTONEXIT
		ret=$?
		if [[ $ret -eq 3 ]]; then
			$SPARKYXTERM "$UNINSTALL $PACKAGE"
		elif [[ $ret -eq 4 ]]; then
			if [ "$PINGTEST" = "" ]; then
				$DIALOG $TITLE"$TITLETEXT" $MSGBOX $TEXT"$LOCAL107 \n\n$LOCAL90"
				exit 1
			fi
			rm -rf $WORKDIRSKYPE
			mkdir -p $WORKDIRSKYPE
			cd $WORKDIRSKYPE
			$SPARKYXTERM "wget $SERVER64SKYPE/$PACK64SKYPE"
			$SPARKYXTERM "dpkg -i $PACK64SKYPE"
			$SPARKYXTERM "$INSTALL -f -y"
		else
			exit 1
		fi
	elif [ ! -d "$CHECKPACKAGE" ]; then
		$DIALOG $TEXT"\n$LOCAL108" $TITLE"$TITLETEXT" $BUTTONINSTALL $BUTTONEXIT
		if [ "$?" = "0" ]; then
			if [ "$PINGTEST" = "" ]; then
				$DIALOG $TITLE"$TITLETEXT" $MSGBOX $TEXT"$LOCAL107 \n\n$LOCAL90"
				exit 1
			fi
			rm -rf $WORKDIRSKYPE
			mkdir -p $WORKDIRSKYPE
			cd $WORKDIRSKYPE
			$SPARKYXTERM "wget $SERVER64SKYPE/$PACK64SKYPE"
			$SPARKYXTERM "dpkg -i $PACK64SKYPE"
			$SPARKYXTERM "$INSTALL -f -y"
			if [ ! -d "$CHECKPACKAGE" ]; then
				$DIALOG $TEXT"\n$LOCAL4" $TITLE"$TITLETEXT" $MSGBOX
				exit 1
			else
				$DIALOG $TEXT"\n$LOCAL109\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
				exit 1
			fi

		elif [ "$?" != "0" ]; then
			exit 1
		fi
	fi

else

# install, reinstall or remove anything else
	if [ -d "$CHECKPACKAGE" ]; then
		$DIALOG $TEXT"\n$LOCAL105\n$LOCAL106" $TITLE"$TITLETEXT" $BUTTONREMOVE $BUTTONREINSTALL $BUTTONEXIT
		ret=$?
		if [[ $ret -eq 3 ]]; then
			$SPARKYXTERM "$UNINSTALL $PACKAGE"
		elif [[ $ret -eq 4 ]]; then
			if [ "$PINGTEST" = "" ]; then
				$DIALOG $TITLE"$TITLETEXT" $MSGBOX $TEXT"$LOCAL107 \n\n$LOCAL90"
				exit 1
			fi
			$SPARKYXTERM "$REINSTALL $PACKAGE"
		else
			exit 1
		fi
	elif [ ! -d "$CHECKPACKAGE" ]; then
		$DIALOG $TEXT"\n$LOCAL108" $TITLE"$TITLETEXT" $BUTTONINSTALL $BUTTONEXIT
		if [ "$?" = "0" ]; then
			if [ "$PINGTEST" = "" ]; then
				$DIALOG $TITLE"$TITLETEXT" $MSGBOX $TEXT"$LOCAL107 \n\n$LOCAL90"
				exit 1
			fi
			$SPARKYXTERM "$INSTALL $PACKAGE"
			if [ ! -d "$CHECKPACKAGE" ]; then
				$DIALOG $TEXT"\n$LOCAL4" $TITLE"$TITLETEXT" $MSGBOX
				exit 1
			else
				$DIALOG $TEXT"\n$LOCAL109\n\n$LOCAL90" $TITLE"$TITLETEXT" $MSGBOX
				exit 1
			fi

		elif [ "$?" != "0" ]; then
			exit 1
		fi
	fi

fi

exit 0
